apiVersion: v1
stringData:
  configuration.yaml: |
    resource:
      group: "kubesphere.io"
      version: "v1alpha1"
      kind: "Extension"
    regoPolicy: |
      package filter

      import rego.v1

      default match := false

      match if {
        not listAvailableExtension
      }

      match if {
        listAvailableExtension
        isSubscribed
      }

      match if {
        listAvailableExtension
        isInstalled
      }

      match if {
        listAvailableExtension
        not hasExtensionID
      }

      listAvailableExtension if ["available"][_] == input.filter.field

      isSubscribed if input.object.metadata.labels["marketplace.kubesphere.io/subscribed"] == "true"

      isInstalled if input.object.status.state != ""

      hasExtensionID if input.object.metadata.labels["marketplace.kubesphere.io/extension-id"] != ""
kind: Secret
metadata:
  name: extensions.customresourcefilters.kubesphere
  namespace: kubesphere-system
type: config.kubesphere.io/custom-resource-filter