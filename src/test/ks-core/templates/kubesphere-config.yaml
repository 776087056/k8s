apiVersion: v1
kind: ConfigMap
metadata:
  name: kubesphere-config
data:
  kubesphere.yaml: |
    authentication:
      authenticateRateLimiterMaxTries: {{ .Values.authentication.authenticateRateLimiterMaxTries | default 10 }}
      authenticateRateLimiterDuration: {{ .Values.authentication.authenticationRateLimiterDuration | default "10m0s" }}
      loginHistoryRetentionPeriod: {{ .Values.authentication.loginHistoryRetentionPeriod | default "168h"  }}
      multipleLogin: {{ .Values.authentication.enableMultiLogin | default true }}
      issuer:
        host: {{ include "portal.host" . | quote }}
        jwtSecret: {{ include "jwtSecret" . | quote }}
        maximumClockSkew: {{ .Values.authentication.issuer.maximumClockSkew | default "10s" }}
        {{- if eq .Values.role "member" }}
        accessTokenMaxAge: 0
        {{- else }}
        accessTokenMaxAge:  {{ .Values.authentication.issuer.accessTokenMaxAge }}
        {{- end }}
        accessTokenInactivityTimeout:  {{ .Values.authentication.issuer.accessTokenInactivityTimeout }}
    multicluster:
      clusterRole: {{ .Values.role }}
    terminal:
      kubectl:
        image: {{ template "kubectl.image" . }}
      node:
        image:  {{ template "nodeShell.image" . }}
    helmExecutor:
      image: {{ template "helm.image" . }}
    extension:
      imageRegistry: {{ default .Values.extension.imageRegistry "" | quote }}
      {{- if .Values.extension.nodeSelector }}
      nodeSelector: {{- toYaml .Values.extension.nodeSelector | nindent 8 }}
      {{- end }}
    {{- if .Values.devMode }}
    telemetry:
      ksCloudURL: "https://clouddev.kubesphere.io"
    {{- end }}